---
tags: [操作系统]
---



感谢[book-riscv-rev1 · 6.S081 All-In-One](http://xv6.dgs.zone/tranlate_books/book-riscv-rev1/summary.html)

## 操作系统接口概述



- 操作系统是硬件上一层的抽象，抽象化了硬件的功能，方便软件去使用



- 内核：特殊的程序，为程序运行提供各种各样的服务
- 进程：运行的程序，有各自的内存空间。
  - 指令
  - 数据
  - 栈：用来组织过程调用的

- 系统调用：进程需要内核提供的服务，是「操作系统接口」之一



- 内核通过硬件提供的保护机制来确保每个进程只能访问他们自己的内存空间。





## 进程和内存

- 进程 = 内存空间 + 内核状态
- fork
- exit 会替换掉当前进程
- shell
  - exit 和 fork 没有组合使用的原因
- xv6会隐式去分配足够的内存，但是也可以通过 `sbrk(n)` 来手动分配



## I/O 和文件描述符

- 所有输入输出**是通过系统调用实现的**
- 0, 1, 2 是基本的文件描述符，就是我们常见的标准输入输出和错误
  - 基本的文件描述符实际关联的是终端设备
  - 另有 `-1` 表示无效，`-2` 表示错误文件描述符
- 而当进程打开其他文件的时候，此时文件就会**被分配一个新的文件描述符给「文件描述符表」**，用于调用的时候查询
  - 文件是通过 `inode` 表示的，即索引节点，**存储元数据 + 指向实际文件的指针**
  - 它不存储文件的实际数据，但是存储其他所有和文件相关的元数据：比如说大小权限所有者等，这些信息也会存到「文件描述符表」中
  - 目录是特殊的文件，用于将文件名关联到 inode



## 管道

- Def
  - 管道是作为一对文件描述符暴露给进程的一块内核缓冲区
  - 给进程提供了一种通信的方式
- 运作原理（还不是特别懂
- Shell 的实现
- 相比临时文件的酉戌丑





## 文件系统

- 组成
  - 数据文件
  - 目录
- 目录形成一个树，根节点是特殊目录 `/`
- `mknod` 创建设备相关的特殊文件
  - 将使用【内核设备】实现rw系统调用，而不是文件系统
- Inode
  - 文件名 = 链接；文件 一般= 文件本身 = 文件数据
  - 链接是【目录】中的一个条目 item
  - Inode 内容
  - fstat 是用来定位磁盘文件的
    - 实质是一个结构体，存储了设备，编号等信息
  - link



## Real World

- 描述符、管道、shell语法结合起来是软件工具文化一大起源

- 目前的很多接口都标准化过了，和 Xv6 还是又很多差别的

  - Xv6 的特点是简单明了
  - Xv6 没有用户概念，全是 root
  - 

- 文件名（链接）配合文件描述符的思想，从目录、文件、设备，扩展到图形和网络，但是有些 Unix-like 却没有发扬这种思想

  - 文件系统 + 文件描述符是强大的抽象

  









***



acv

